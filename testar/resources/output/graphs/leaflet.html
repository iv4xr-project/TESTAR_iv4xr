<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Leaflet HeatMap Navigable Nodes</title>
	<link rel="stylesheet" href="css/leaflet.css" />
	<script src="js/leaflet.js"></script>
	<script src="js/leaflet-heat.js"></script>

</head>

<body>
    <h1>Leaflet HeatMap Navigable Nodes</h1>
    <div id="map" style="width: 1600px; height: 800px; background-color: #E5E5E5;"></div>

<script>
	// This list contains all the discovered navigable nodes
	// NOT the executed / explored
	// [<8.4,0.03,3.78>, <3.84,0.03,38.399998>, <4.2599998,0.03,17.4>, <3.6,0.03,40.8>]
	var discovered = localStorage.getItem('navigableNodes');

	// This list contains the discovered that are not yet explored
	// [(AACtxbm5q1b527377552, <3.78,0.03,15.36>), (AACo389aa1e2437263485, <8.219999,0.03,40.8>), (AAC1uv330o24728734897, <4.2599998,0.03,38.399998>)]
	var unexplored = localStorage.getItem('unexecutedExploratoryActions');

	var map = L.map('map').setView([0, 0], 5);

	drawHeatMapDiscovered(discovered, 'blue');
	drawHeatMapUnexplored(unexplored, 'red');

	function drawHeatMapDiscovered(original, color) {
		var positions = original.split(">").length - 1;
		console.log('number of discovered nodes: ' + positions);
		console.log(original);

		const data = [];

		for(var i = 0; i < positions; i++){
			var coordString = original.substring(
				original.indexOf("<"), 
				original.indexOf(">") + 1
			);

			var x = coordString.substring(
				coordString.indexOf("<") + 1, 
				coordString.indexOf(",")
			);

			var y = coordString.substring(
				coordString.lastIndexOf(",") + 1, 
				coordString.indexOf(">")
			);

			coordString = coordString + ","
			original = original.replace(coordString,"");

			data.push([parseFloat(x), parseFloat(y)]);
			console.log(data);
		}

		var heat = L.heatLayer(data, {
			radius: 1.25,
			minOpacity : 1,
			blur: 1,
			gradient: {1: color}
			}).addTo(map);
	}

	function drawHeatMapUnexplored(original, color) {
		// If unexplored list contains empty, means that all positions were explored
		if(original.includes("(empty, <0.0,0.0,0.0>)")){return;}

		var positions = original.split(">").length - 1;
		console.log('number of unexecuted nodes: ' + positions);
		console.log(original);

		const data = [];

		for(var i = 0; i < positions; i++){
			var coordString = original.substring(
				original.indexOf("<"), 
				original.indexOf(">") + 1
			);

			var x = coordString.substring(
				coordString.indexOf("<") + 1, 
				coordString.indexOf(",")
			);

			var y = coordString.substring(
				coordString.lastIndexOf(",") + 1, 
				coordString.indexOf(">")
			);

			var coordToReplace = original.substring(
				original.indexOf("("), 
				original.indexOf(")") + 1
			);

			coordToReplace = coordToReplace + ","
			original = original.replace(coordToReplace,"");

			data.push([parseFloat(x), parseFloat(y)]);
			console.log(data);
		}

		var heat = L.heatLayer(data, {
			radius: 1.25,
			minOpacity : 1,
			blur: 1,
			gradient: {1: color}
			}).addTo(map);
	}
</script>


</body>
</html>